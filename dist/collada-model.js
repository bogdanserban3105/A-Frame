(()=>{"use strict";const e=THREE;class t extends e.DataTextureLoader{constructor(e){super(e)}parse(t){t.length<19&&console.error("THREE.TGALoader: Not enough data to contain header.");let n=0;const o=new Uint8Array(t),s={id_length:o[n++],colormap_type:o[n++],image_type:o[n++],colormap_index:o[n++]|o[n++]<<8,colormap_length:o[n++]|o[n++]<<8,colormap_size:o[n++],origin:[o[n++]|o[n++]<<8,o[n++]|o[n++]<<8],width:o[n++]|o[n++]<<8,height:o[n++]|o[n++]<<8,pixel_size:o[n++],flags:o[n++]};!function(e){switch(e.image_type){case 1:case 9:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&console.error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case 2:case 3:case 10:case 11:e.colormap_type&&console.error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case 0:console.error("THREE.TGALoader: No data.");default:console.error('THREE.TGALoader: Invalid type "%s".',e.image_type)}(e.width<=0||e.height<=0)&&console.error("THREE.TGALoader: Invalid image size."),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&console.error('THREE.TGALoader: Invalid pixel size "%s".',e.pixel_size)}(s),s.id_length+n>t.length&&console.error("THREE.TGALoader: No data."),n+=s.id_length;let r=!1,i=!1,a=!1;switch(s.image_type){case 9:r=!0,i=!0;break;case 1:i=!0;break;case 10:r=!0;break;case 2:break;case 11:r=!0,a=!0;break;case 3:a=!0}const c=new Uint8Array(s.width*s.height*4),l=function(e,t,n,o,s){let r,i;const a=n.pixel_size>>3,c=n.width*n.height*a;if(t&&(i=s.subarray(o,o+=n.colormap_length*(n.colormap_size>>3))),e){let e,t,n;r=new Uint8Array(c);let i=0;const l=new Uint8Array(a);for(;i<c;)if(e=s[o++],t=1+(127&e),128&e){for(n=0;n<a;++n)l[n]=s[o++];for(n=0;n<t;++n)r.set(l,i+n*a);i+=a*t}else{for(t*=a,n=0;n<t;++n)r[i+n]=s[o++];i+=t}}else r=s.subarray(o,o+=t?n.width*n.height:c);return{pixel_data:r,palettes:i}}(r,i,s,n,o);return function(e,t,n,o,r){let i,c,l,d,u,f;switch((48&s.flags)>>4){default:case 2:i=0,l=1,u=t,c=0,d=1,f=n;break;case 0:i=0,l=1,u=t,c=n-1,d=-1,f=-1;break;case 3:i=t-1,l=-1,u=-1,c=0,d=1,f=n;break;case 1:i=t-1,l=-1,u=-1,c=n-1,d=-1,f=-1}if(a)switch(s.pixel_size){case 8:!function(e,t,n,o,r,i,a,c){let l,d,u,f=0;const h=s.width;for(u=t;u!==o;u+=n)for(d=r;d!==a;d+=i,f++)l=c[f],e[4*(d+h*u)+0]=l,e[4*(d+h*u)+1]=l,e[4*(d+h*u)+2]=l,e[4*(d+h*u)+3]=255}(e,c,d,f,i,l,u,o);break;case 16:!function(e,t,n,o,r,i,a,c){let l,d,u=0;const f=s.width;for(d=t;d!==o;d+=n)for(l=r;l!==a;l+=i,u+=2)e[4*(l+f*d)+0]=c[u+0],e[4*(l+f*d)+1]=c[u+0],e[4*(l+f*d)+2]=c[u+0],e[4*(l+f*d)+3]=c[u+1]}(e,c,d,f,i,l,u,o);break;default:console.error("THREE.TGALoader: Format not supported.")}else switch(s.pixel_size){case 8:!function(e,t,n,o,r,i,a,c,l){const d=l;let u,f,h,m=0;const p=s.width;for(h=t;h!==o;h+=n)for(f=r;f!==a;f+=i,m++)u=c[m],e[4*(f+p*h)+3]=255,e[4*(f+p*h)+2]=d[3*u+0],e[4*(f+p*h)+1]=d[3*u+1],e[4*(f+p*h)+0]=d[3*u+2]}(e,c,d,f,i,l,u,o,r);break;case 16:!function(e,t,n,o,r,i,a,c){let l,d,u,f=0;const h=s.width;for(u=t;u!==o;u+=n)for(d=r;d!==a;d+=i,f+=2)l=c[f+0]+(c[f+1]<<8),e[4*(d+h*u)+0]=(31744&l)>>7,e[4*(d+h*u)+1]=(992&l)>>2,e[4*(d+h*u)+2]=(31&l)<<3,e[4*(d+h*u)+3]=32768&l?0:255}(e,c,d,f,i,l,u,o);break;case 24:!function(e,t,n,o,r,i,a,c){let l,d,u=0;const f=s.width;for(d=t;d!==o;d+=n)for(l=r;l!==a;l+=i,u+=3)e[4*(l+f*d)+3]=255,e[4*(l+f*d)+2]=c[u+0],e[4*(l+f*d)+1]=c[u+1],e[4*(l+f*d)+0]=c[u+2]}(e,c,d,f,i,l,u,o);break;case 32:!function(e,t,n,o,r,i,a,c){let l,d,u=0;const f=s.width;for(d=t;d!==o;d+=n)for(l=r;l!==a;l+=i,u+=4)e[4*(l+f*d)+2]=c[u+0],e[4*(l+f*d)+1]=c[u+1],e[4*(l+f*d)+0]=c[u+2],e[4*(l+f*d)+3]=c[u+3]}(e,c,d,f,i,l,u,o);break;default:console.error("THREE.TGALoader: Format not supported.")}}(c,s.width,s.height,l.pixel_data,l.palettes),{data:c,width:s.width,height:s.height,flipY:!0,generateMipmaps:!0,minFilter:e.LinearMipmapLinearFilter}}}class n extends e.Loader{constructor(e){super(e)}load(t,n,o,s){const r=this,i=""===r.path?e.LoaderUtils.extractUrlBase(t):r.path,a=new e.FileLoader(r.manager);a.setPath(r.path),a.setRequestHeader(r.requestHeader),a.setWithCredentials(r.withCredentials),a.load(t,(function(e){try{n(r.parse(e,i))}catch(e){s?s(e):console.error(e),r.manager.itemError(t)}}),o,s)}parse(n,o){function s(e,t){const n=[],o=e.childNodes;for(let e=0,s=o.length;e<s;e++){const s=o[e];s.nodeName===t&&n.push(s)}return n}function r(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),n=new Array(t.length);for(let e=0,o=t.length;e<o;e++)n[e]=t[e];return n}function i(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),n=new Array(t.length);for(let e=0,o=t.length;e<o;e++)n[e]=parseFloat(t[e]);return n}function a(e){if(0===e.length)return[];const t=e.trim().split(/\s+/),n=new Array(t.length);for(let e=0,o=t.length;e<o;e++)n[e]=parseInt(t[e]);return n}function c(e){return e.substring(1)}function l(e){return 0===Object.keys(e).length}function d(e){return void 0!==e&&!0===e.hasAttribute("meter")?parseFloat(e.getAttribute("meter")):1}function u(e){return void 0!==e?e.textContent:"Y_UP"}function f(e,t,n,o){const r=s(e,t)[0];if(void 0!==r){const e=s(r,n);for(let t=0;t<e.length;t++)o(e[t])}}function h(e,t){for(const n in e)e[n].build=t(e[n])}function m(e,t){return void 0!==e.build||(e.build=t(e)),e.build}function p(e){const t={inputs:{}};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];if(1===o.nodeType&&"input"===o.nodeName){const e=c(o.getAttribute("source")),n=o.getAttribute("semantic");t.inputs[n]=e}}return t}function g(e){const t={};let n=e.getAttribute("target").split("/");const o=n.shift();let s=n.shift();const r=-1!==s.indexOf("("),i=-1!==s.indexOf(".");if(i)n=s.split("."),s=n.shift(),t.member=n.shift();else if(r){const e=s.split("(");s=e.shift();for(let t=0;t<e.length;t++)e[t]=parseInt(e[t].replace(/\)/,""));t.indices=e}return t.id=o,t.sid=s,t.arraySyntax=r,t.memberSyntax=i,t.sampler=c(e.getAttribute("source")),t}function b(e){const t=[],n=e.channels,o=e.samplers,s=e.sources;for(const e in n)if(n.hasOwnProperty(e)){const r=n[e],i=o[r.sampler],a=i.inputs.INPUT,c=i.inputs.OUTPUT;A(N(r,s[a],s[c]),t)}return t}function y(e){return m(Qe.animations[e],b)}function N(e,t,n){const o=Qe.nodes[e.id],s=Ue(o.id),r=o.transforms[e.sid],i=o.matrix.clone().transpose();let a,c,l,d,u,f;const h={};switch(r){case"matrix":for(l=0,d=t.array.length;l<d;l++)if(a=t.array[l],c=l*n.stride,void 0===h[a]&&(h[a]={}),!0===e.arraySyntax){const t=n.array[c],o=e.indices[0]+4*e.indices[1];h[a][o]=t}else for(u=0,f=n.stride;u<f;u++)h[a][u]=n.array[c+u];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',r)}const m=function(e,t){const n=[];for(const t in e)n.push({time:parseFloat(t),value:e[t]});n.sort((function(e,t){return e.time-t.time}));for(let e=0;e<16;e++)v(n,e,t.elements[e]);return n}(h,i);return{name:s.uuid,keyframes:m}}const w=new e.Vector3,x=new e.Vector3,k=new e.Quaternion;function A(t,n){const o=t.keyframes,s=t.name,r=[],i=[],a=[],c=[];for(let e=0,t=o.length;e<t;e++){const t=o[e],n=t.time,s=t.value;Ee.fromArray(s).transpose(),Ee.decompose(w,k,x),r.push(n),i.push(w.x,w.y,w.z),a.push(k.x,k.y,k.z,k.w),c.push(x.x,x.y,x.z)}return i.length>0&&n.push(new e.VectorKeyframeTrack(s+".position",r,i)),a.length>0&&n.push(new e.QuaternionKeyframeTrack(s+".quaternion",r,a)),c.length>0&&n.push(new e.VectorKeyframeTrack(s+".scale",r,c)),n}function v(e,t,n){let o,s,r,i=!0;for(s=0,r=e.length;s<r;s++)o=e[s],void 0===o.value[t]?o.value[t]=null:i=!1;if(!0===i)for(s=0,r=e.length;s<r;s++)o=e[s],o.value[t]=n;else!function(e,t){let n,o;for(let s=0,r=e.length;s<r;s++){const r=e[s];if(null===r.value[t]){if(n=T(e,s,t),o=C(e,s,t),null===n){r.value[t]=o.value[t];continue}if(null===o){r.value[t]=n.value[t];continue}E(r,n,o,t)}}}(e,t)}function T(e,t,n){for(;t>=0;){const o=e[t];if(null!==o.value[n])return o;t--}return null}function C(e,t,n){for(;t<e.length;){const o=e[t];if(null!==o.value[n])return o;t++}return null}function E(e,t,n,o){n.time-t.time!=0?e.value[o]=(e.time-t.time)*(n.value[o]-t.value[o])/(n.time-t.time)+t.value[o]:e.value[o]=t.value[o]}function _(t){const n=[],o=t.name,s=t.end-t.start||-1,r=t.animations;for(let e=0,t=r.length;e<t;e++){const t=y(r[e]);for(let e=0,o=t.length;e<o;e++)n.push(t[e])}return new e.AnimationClip(o,s,n)}function R(e){return m(Qe.clips[e],_)}function L(e){const t={sources:{}};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=i(o.textContent);break;case"source":const e=o.getAttribute("id");t.sources[e]=ae(o);break;case"joints":t.joints=M(o);break;case"vertex_weights":t.vertexWeights=O(o)}}return t}function M(e){const t={inputs:{}};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];if(1===o.nodeType&&"input"===o.nodeName){const e=o.getAttribute("semantic"),n=c(o.getAttribute("source"));t.inputs[e]=n}}return t}function O(e){const t={inputs:{}};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"input":const e=o.getAttribute("semantic"),n=c(o.getAttribute("source")),s=parseInt(o.getAttribute("offset"));t.inputs[e]={id:n,offset:s};break;case"vcount":t.vcount=a(o.textContent);break;case"v":t.v=a(o.textContent)}}return t}function I(t){const n={id:t.id},o=Qe.geometries[n.id];return void 0!==t.skin&&(n.skin=function(t){const n={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},o=t.sources,s=t.vertexWeights,r=s.vcount,i=s.v,a=s.inputs.JOINT.offset,c=s.inputs.WEIGHT.offset,l=t.sources[t.joints.inputs.JOINT],d=t.sources[t.joints.inputs.INV_BIND_MATRIX],u=o[s.inputs.WEIGHT.id].array;let f,h,m,p=0;for(f=0,m=r.length;f<m;f++){const e=r[f],t=[];for(h=0;h<e;h++){const e=i[p+a],n=u[i[p+c]];t.push({index:e,weight:n}),p+=2}for(t.sort(g),h=0;h<4;h++){const e=t[h];void 0!==e?(n.indices.array.push(e.index),n.weights.array.push(e.weight)):(n.indices.array.push(0),n.weights.array.push(0))}}for(t.bindShapeMatrix?n.bindMatrix=(new e.Matrix4).fromArray(t.bindShapeMatrix).transpose():n.bindMatrix=(new e.Matrix4).identity(),f=0,m=l.array.length;f<m;f++){const t=l.array[f],o=(new e.Matrix4).fromArray(d.array,f*d.stride).transpose();n.joints.push({name:t,boneInverse:o})}return n;function g(e,t){return t.weight-e.weight}}(t.skin),o.sources.skinIndices=n.skin.indices,o.sources.skinWeights=n.skin.weights),n}function j(e){return void 0!==e.build?e.build:e.init_from}function q(e){const t=Qe.images[e];return void 0!==t?m(t,j):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",e),null)}function S(e){const t={surfaces:{},samplers:{}};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"newparam":H(o,t);break;case"technique":t.technique=F(o);break;case"extra":t.extra=W(o)}}return t}function H(e,t){const n=e.getAttribute("sid");for(let o=0,s=e.childNodes.length;o<s;o++){const s=e.childNodes[o];if(1===s.nodeType)switch(s.nodeName){case"surface":t.surfaces[n]=U(s);break;case"sampler2D":t.samplers[n]=B(s)}}}function U(e){const t={};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];1===o.nodeType&&"init_from"===o.nodeName&&(t.init_from=o.textContent)}return t}function B(e){const t={};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];1===o.nodeType&&"source"===o.nodeName&&(t.source=o.textContent)}return t}function F(e){const t={};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=o.nodeName,t.parameters=G(o);break;case"extra":t.extra=W(o)}}return t}function G(e){const t={};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":t[o.nodeName]=z(o);break;case"transparent":t[o.nodeName]={opaque:o.hasAttribute("opaque")?o.getAttribute("opaque"):"A_ONE",data:z(o)}}}return t}function z(e){const t={};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"color":t[o.nodeName]=i(o.textContent);break;case"float":t[o.nodeName]=parseFloat(o.textContent);break;case"texture":t[o.nodeName]={id:o.getAttribute("texture"),extra:P(o)}}}return t}function P(e){const t={technique:{}};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];1===o.nodeType&&"extra"===o.nodeName&&V(o,t)}return t}function V(e,t){for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];1===o.nodeType&&"technique"===o.nodeName&&D(o,t)}}function D(e,t){for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[o.nodeName]=parseFloat(o.textContent);break;case"wrapU":case"wrapV":"TRUE"===o.textContent.toUpperCase()?t.technique[o.nodeName]=1:"FALSE"===o.textContent.toUpperCase()?t.technique[o.nodeName]=0:t.technique[o.nodeName]=parseInt(o.textContent);break;case"bump":t[o.nodeName]=X(o)}}}function W(e){const t={};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];1===o.nodeType&&"technique"===o.nodeName&&(t.technique=J(o))}return t}function J(e){const t={};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"double_sided":t[o.nodeName]=parseInt(o.textContent);break;case"bump":t[o.nodeName]=X(o)}}return t}function X(e){const t={};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];1===o.nodeType&&"texture"===o.nodeName&&(t[o.nodeName]={id:o.getAttribute("texture"),texcoord:o.getAttribute("texcoord"),extra:P(o)})}return t}function K(e){return e}function Y(t){const n=(o=t.url,m(Qe.effects[o],K));var o;const s=n.profile.technique;let r;switch(s.type){case"phong":case"blinn":r=new e.MeshPhongMaterial;break;case"lambert":r=new e.MeshLambertMaterial;break;default:r=new e.MeshBasicMaterial}function i(t,o=null){const s=n.profile.samplers[t.id];let r=null;if(void 0!==s?r=q(n.profile.surfaces[s.source].init_from):(console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),r=q(t.id)),null!==r){const n=function(e){let t,n=e.slice(2+(e.lastIndexOf(".")-1>>>0));return n=n.toLowerCase(),t="tga"===n?Je:We,t}(r);if(void 0!==n){const s=n.load(r),i=t.extra;if(void 0!==i&&void 0!==i.technique&&!1===l(i.technique)){const t=i.technique;s.wrapS=t.wrapU?e.RepeatWrapping:e.ClampToEdgeWrapping,s.wrapT=t.wrapV?e.RepeatWrapping:e.ClampToEdgeWrapping,s.offset.set(t.offsetU||0,t.offsetV||0),s.repeat.set(t.repeatU||1,t.repeatV||1)}else s.wrapS=e.RepeatWrapping,s.wrapT=e.RepeatWrapping;return null!==o&&(s.encoding=o),s}return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",r),null}return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",t.id),null}r.name=t.name||"";const a=s.parameters;for(const t in a){const n=a[t];switch(t){case"diffuse":n.color&&r.color.fromArray(n.color),n.texture&&(r.map=i(n.texture,e.sRGBEncoding));break;case"specular":n.color&&r.specular&&r.specular.fromArray(n.color),n.texture&&(r.specularMap=i(n.texture));break;case"bump":n.texture&&(r.normalMap=i(n.texture));break;case"ambient":n.texture&&(r.lightMap=i(n.texture,e.sRGBEncoding));break;case"shininess":n.float&&r.shininess&&(r.shininess=n.float);break;case"emission":n.color&&r.emissive&&r.emissive.fromArray(n.color),n.texture&&(r.emissiveMap=i(n.texture,e.sRGBEncoding))}}r.color.convertSRGBToLinear(),r.specular&&r.specular.convertSRGBToLinear(),r.emissive&&r.emissive.convertSRGBToLinear();let c=a.transparent,d=a.transparency;if(void 0===d&&c&&(d={float:1}),void 0===c&&d&&(c={opaque:"A_ONE",data:{color:[1,1,1,1]}}),c&&d)if(c.data.texture)r.transparent=!0;else{const e=c.data.color;switch(c.opaque){case"A_ONE":r.opacity=e[3]*d.float;break;case"RGB_ZERO":r.opacity=1-e[0]*d.float;break;case"A_ZERO":r.opacity=1-e[3]*d.float;break;case"RGB_ONE":r.opacity=e[0]*d.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',c.opaque)}r.opacity<1&&(r.transparent=!0)}if(void 0!==s.extra&&void 0!==s.extra.technique){const t=s.extra.technique;for(const n in t){const o=t[n];switch(n){case"double_sided":r.side=1===o?e.DoubleSide:e.FrontSide;break;case"bump":r.normalMap=i(o.texture),r.normalScale=new e.Vector2(1,1)}}}return r}function Z(e){return m(Qe.materials[e],Y)}function Q(e){for(let t=0;t<e.childNodes.length;t++){const n=e.childNodes[t];if("technique_common"===n.nodeName)return $(n)}return{}}function $(e){const t={};for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];switch(o.nodeName){case"perspective":case"orthographic":t.technique=o.nodeName,t.parameters=ee(o)}}return t}function ee(e){const t={};for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];switch(o.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[o.nodeName]=parseFloat(o.textContent)}}return t}function te(t){let n;switch(t.optics.technique){case"perspective":n=new e.PerspectiveCamera(t.optics.parameters.yfov,t.optics.parameters.aspect_ratio,t.optics.parameters.znear,t.optics.parameters.zfar);break;case"orthographic":let o=t.optics.parameters.ymag,s=t.optics.parameters.xmag;const r=t.optics.parameters.aspect_ratio;s=void 0===s?o*r:s,o=void 0===o?s/r:o,s*=.5,o*=.5,n=new e.OrthographicCamera(-s,s,o,-o,t.optics.parameters.znear,t.optics.parameters.zfar);break;default:n=new e.PerspectiveCamera}return n.name=t.name||"",n}function ne(e){const t=Qe.cameras[e];return void 0!==t?m(t,te):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",e),null)}function oe(e){const t={};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=o.nodeName,t.parameters=se(o)}}return t}function se(t){const n={};for(let o=0,s=t.childNodes.length;o<s;o++){const s=t.childNodes[o];if(1===s.nodeType)switch(s.nodeName){case"color":const t=i(s.textContent);n.color=(new e.Color).fromArray(t).convertSRGBToLinear();break;case"falloff_angle":n.falloffAngle=parseFloat(s.textContent);break;case"quadratic_attenuation":const o=parseFloat(s.textContent);n.distance=o?Math.sqrt(1/o):0}}return n}function re(t){let n;switch(t.technique){case"directional":n=new e.DirectionalLight;break;case"point":n=new e.PointLight;break;case"spot":n=new e.SpotLight;break;case"ambient":n=new e.AmbientLight}return t.parameters.color&&n.color.copy(t.parameters.color),t.parameters.distance&&(n.distance=t.parameters.distance),n}function ie(e){const t=Qe.lights[e];return void 0!==t?m(t,re):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",e),null)}function ae(e){const t={array:[],stride:3};for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"float_array":t.array=i(o.textContent);break;case"Name_array":t.array=r(o.textContent);break;case"technique_common":const e=s(o,"accessor")[0];void 0!==e&&(t.stride=parseInt(e.getAttribute("stride")))}}return t}function ce(e){const t={};for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];1===o.nodeType&&(t[o.getAttribute("semantic")]=c(o.getAttribute("source")))}return t}function le(e){const t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"input":const e=c(o.getAttribute("source")),n=o.getAttribute("semantic"),s=parseInt(o.getAttribute("offset")),r=parseInt(o.getAttribute("set")),i=r>0?n+r:n;t.inputs[i]={id:e,offset:s},t.stride=Math.max(t.stride,s+1),"TEXCOORD"===n&&(t.hasUV=!0);break;case"vcount":t.vcount=a(o.textContent);break;case"p":t.p=a(o.textContent)}}return t}function de(e){let t=0;for(let n=0,o=e.length;n<o;n++)!0===e[n].hasUV&&t++;t>0&&t<e.length&&(e.uvsNeedsFix=!0)}function ue(e){const t={},n=e.sources,o=e.vertices,s=e.primitives;if(0===s.length)return{};const r=function(e){const t={};for(let n=0;n<e.length;n++){const o=e[n];void 0===t[o.type]&&(t[o.type]=[]),t[o.type].push(o)}return t}(s);for(const e in r){const s=r[e];de(s),t[e]=fe(s,n,o)}return t}function fe(t,n,o){const s={},r={array:[],stride:0},i={array:[],stride:0},a={array:[],stride:0},c={array:[],stride:0},l={array:[],stride:0},d=[],u=[],f=new e.BufferGeometry,h=[];let m=0;for(let e=0;e<t.length;e++){const s=t[e],p=s.inputs;let g=0;switch(s.type){case"lines":case"linestrips":g=2*s.count;break;case"triangles":g=3*s.count;break;case"polylist":for(let e=0;e<s.count;e++){const t=s.vcount[e];switch(t){case 3:g+=3;break;case 4:g+=6;break;default:g+=3*(t-2)}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",s.type)}f.addGroup(m,g,e),m+=g,s.material&&h.push(s.material);for(const e in p){const f=p[e];switch(e){case"VERTEX":for(const e in o){const h=o[e];switch(e){case"POSITION":const o=r.array.length;if(he(s,n[h],f.offset,r.array),r.stride=n[h].stride,n.skinWeights&&n.skinIndices&&(he(s,n.skinIndices,f.offset,d),he(s,n.skinWeights,f.offset,u)),!1===s.hasUV&&!0===t.uvsNeedsFix){const e=(r.array.length-o)/r.stride;for(let t=0;t<e;t++)a.array.push(0,0)}break;case"NORMAL":he(s,n[h],f.offset,i.array),i.stride=n[h].stride;break;case"COLOR":he(s,n[h],f.offset,l.array),l.stride=n[h].stride;break;case"TEXCOORD":he(s,n[h],f.offset,a.array),a.stride=n[h].stride;break;case"TEXCOORD1":he(s,n[h],f.offset,c.array),a.stride=n[h].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',e)}}break;case"NORMAL":he(s,n[f.id],f.offset,i.array),i.stride=n[f.id].stride;break;case"COLOR":he(s,n[f.id],f.offset,l.array,!0),l.stride=n[f.id].stride;break;case"TEXCOORD":he(s,n[f.id],f.offset,a.array),a.stride=n[f.id].stride;break;case"TEXCOORD1":he(s,n[f.id],f.offset,c.array),c.stride=n[f.id].stride}}}return r.array.length>0&&f.setAttribute("position",new e.Float32BufferAttribute(r.array,r.stride)),i.array.length>0&&f.setAttribute("normal",new e.Float32BufferAttribute(i.array,i.stride)),l.array.length>0&&f.setAttribute("color",new e.Float32BufferAttribute(l.array,l.stride)),a.array.length>0&&f.setAttribute("uv",new e.Float32BufferAttribute(a.array,a.stride)),c.array.length>0&&f.setAttribute("uv2",new e.Float32BufferAttribute(c.array,c.stride)),d.length>0&&f.setAttribute("skinIndex",new e.Float32BufferAttribute(d,4)),u.length>0&&f.setAttribute("skinWeight",new e.Float32BufferAttribute(u,4)),s.data=f,s.type=t[0].type,s.materialKeys=h,s}function he(e,t,n,o,s=!1){const r=e.p,i=e.stride,a=e.vcount;function c(e){let t=r[e+n]*d;const i=t+d;for(;t<i;t++)o.push(l[t]);if(s){const e=o.length-d-1;Xe.setRGB(o[e+0],o[e+1],o[e+2]).convertSRGBToLinear(),o[e+0]=Xe.r,o[e+1]=Xe.g,o[e+2]=Xe.b}}const l=t.array,d=t.stride;if(void 0!==e.vcount){let e=0;for(let t=0,n=a.length;t<n;t++){const n=a[t];if(4===n){const t=e+1*i,n=e+2*i,o=e+3*i;c(e+0*i),c(t),c(o),c(t),c(n),c(o)}else if(3===n){const t=e+1*i,n=e+2*i;c(e+0*i),c(t),c(n)}else if(n>4)for(let t=1,o=n-2;t<=o;t++){const n=e+i*t,o=e+i*(t+1);c(e+0*i),c(n),c(o)}e+=i*n}}else for(let e=0,t=r.length;e<t;e+=i)c(e)}function me(e){return m(Qe.geometries[e],ue)}function pe(e){return void 0!==e.build?e.build:e}function ge(e,t){for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"joint":t.joints[o.getAttribute("sid")]=be(o);break;case"link":t.links.push(Ne(o))}}}function be(e){let t;for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"prismatic":case"revolute":t=ye(o)}}return t}function ye(t){const n={sid:t.getAttribute("sid"),name:t.getAttribute("name")||"",axis:new e.Vector3,limits:{min:0,max:0},type:t.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(let e=0;e<t.childNodes.length;e++){const o=t.childNodes[e];if(1===o.nodeType)switch(o.nodeName){case"axis":const e=i(o.textContent);n.axis.fromArray(e);break;case"limits":const t=o.getElementsByTagName("max")[0],s=o.getElementsByTagName("min")[0];n.limits.max=parseFloat(t.textContent),n.limits.min=parseFloat(s.textContent)}}return n.limits.min>=n.limits.max&&(n.static=!0),n.middlePosition=(n.limits.min+n.limits.max)/2,n}function Ne(e){const t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]};for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"attachment_full":t.attachments.push(we(o));break;case"matrix":case"translate":case"rotate":t.transforms.push(xe(o))}}return t}function we(e){const t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]};for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"link":t.links.push(Ne(o));break;case"matrix":case"translate":case"rotate":t.transforms.push(xe(o))}}return t}function xe(t){const n={type:t.nodeName},o=i(t.textContent);switch(n.type){case"matrix":n.obj=new e.Matrix4,n.obj.fromArray(o).transpose();break;case"translate":n.obj=new e.Vector3,n.obj.fromArray(o);break;case"rotate":n.obj=new e.Vector3,n.obj.fromArray(o),n.angle=e.MathUtils.degToRad(o[3])}return n}function ke(e,t){for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];1===o.nodeType&&"technique_common"===o.nodeName&&Ae(o,t)}}function Ae(e,t){for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"inertia":t.inertia=i(o.textContent);break;case"mass":t.mass=i(o.textContent)[0]}}}function ve(e){const t={target:e.getAttribute("target").split("/").pop()};for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];if(1===o.nodeType&&"axis"===o.nodeName){const e=o.getElementsByTagName("param")[0];t.axis=e.textContent;const n=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=n.substring(0,n.length-1)}}return t}function Te(e){return void 0!==e.build?e.build:e}function Ce(t){const n=[],o=ze.querySelector('[id="'+t.id+'"]');for(let t=0;t<o.childNodes.length;t++){const s=o.childNodes[t];if(1!==s.nodeType)continue;let r,a;switch(s.nodeName){case"matrix":r=i(s.textContent);const t=(new e.Matrix4).fromArray(r).transpose();n.push({sid:s.getAttribute("sid"),type:s.nodeName,obj:t});break;case"translate":case"scale":r=i(s.textContent),a=(new e.Vector3).fromArray(r),n.push({sid:s.getAttribute("sid"),type:s.nodeName,obj:a});break;case"rotate":r=i(s.textContent),a=(new e.Vector3).fromArray(r);const o=e.MathUtils.degToRad(r[3]);n.push({sid:s.getAttribute("sid"),type:s.nodeName,obj:a,angle:o})}}return n}const Ee=new e.Matrix4,_e=new e.Vector3;function Re(t){const n={name:t.getAttribute("name")||"",type:t.getAttribute("type"),id:t.getAttribute("id"),sid:t.getAttribute("sid"),matrix:new e.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}};for(let o=0;o<t.childNodes.length;o++){const s=t.childNodes[o];if(1!==s.nodeType)continue;let r;switch(s.nodeName){case"node":n.nodes.push(s.getAttribute("id")),Re(s);break;case"instance_camera":n.instanceCameras.push(c(s.getAttribute("url")));break;case"instance_controller":n.instanceControllers.push(Le(s));break;case"instance_light":n.instanceLights.push(c(s.getAttribute("url")));break;case"instance_geometry":n.instanceGeometries.push(Le(s));break;case"instance_node":n.instanceNodes.push(c(s.getAttribute("url")));break;case"matrix":r=i(s.textContent),n.matrix.multiply(Ee.fromArray(r).transpose()),n.transforms[s.getAttribute("sid")]=s.nodeName;break;case"translate":r=i(s.textContent),_e.fromArray(r),n.matrix.multiply(Ee.makeTranslation(_e.x,_e.y,_e.z)),n.transforms[s.getAttribute("sid")]=s.nodeName;break;case"rotate":r=i(s.textContent);const t=e.MathUtils.degToRad(r[3]);n.matrix.multiply(Ee.makeRotationAxis(_e.fromArray(r),t)),n.transforms[s.getAttribute("sid")]=s.nodeName;break;case"scale":r=i(s.textContent),n.matrix.scale(_e.fromArray(r)),n.transforms[s.getAttribute("sid")]=s.nodeName;break;case"extra":break;default:console.log(s)}}return He(n.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",n.id):Qe.nodes[n.id]=n,n}function Le(e){const t={id:c(e.getAttribute("url")),materials:{},skeletons:[]};for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];switch(o.nodeName){case"bind_material":const e=o.getElementsByTagName("instance_material");for(let n=0;n<e.length;n++){const o=e[n],s=o.getAttribute("symbol"),r=o.getAttribute("target");t.materials[s]=c(r)}break;case"skeleton":t.skeletons.push(c(o.textContent))}}return t}function Me(t,n){const o=[],s=[];let r,i,a;for(r=0;r<t.length;r++){const e=t[r];let s;if(He(e))s=Ue(e),Oe(s,n,o);else if(c=e,void 0!==Qe.visualScenes[c]){const t=Qe.visualScenes[e].children;for(let e=0;e<t.length;e++){const s=t[e];"JOINT"===s.type&&Oe(Ue(s.id),n,o)}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",e)}var c;for(r=0;r<n.length;r++)for(i=0;i<o.length;i++)if(a=o[i],a.bone.name===n[r].name){s[r]=a,a.processed=!0;break}for(r=0;r<o.length;r++)a=o[r],!1===a.processed&&(s.push(a),a.processed=!0);const l=[],d=[];for(r=0;r<s.length;r++)a=s[r],l.push(a.bone),d.push(a.boneInverse);return new e.Skeleton(l,d)}function Oe(t,n,o){t.traverse((function(t){if(!0===t.isBone){let s;for(let e=0;e<n.length;e++){const o=n[e];if(o.name===t.name){s=o.boneInverse;break}}void 0===s&&(s=new e.Matrix4),o.push({bone:t,boneInverse:s,processed:!1})}}))}function Ie(t){const n=[],o=t.matrix,s=t.nodes,r=t.type,i=t.instanceCameras,a=t.instanceControllers,c=t.instanceLights,l=t.instanceGeometries,d=t.instanceNodes;for(let e=0,t=s.length;e<t;e++)n.push(Ue(s[e]));for(let e=0,t=i.length;e<t;e++){const t=ne(i[e]);null!==t&&n.push(t.clone())}for(let e=0,t=a.length;e<t;e++){const t=a[e],o=(u=t.id,m(Qe.controllers[u],I)),s=Se(me(o.id),t.materials),r=Me(t.skeletons,o.skin.joints);for(let e=0,t=s.length;e<t;e++){const t=s[e];t.isSkinnedMesh&&(t.bind(r,o.skin.bindMatrix),t.normalizeSkinWeights()),n.push(t)}}var u;for(let e=0,t=c.length;e<t;e++){const t=ie(c[e]);null!==t&&n.push(t.clone())}for(let e=0,t=l.length;e<t;e++){const t=l[e],o=Se(me(t.id),t.materials);for(let e=0,t=o.length;e<t;e++)n.push(o[e])}for(let e=0,t=d.length;e<t;e++)n.push(Ue(d[e]).clone());let f;if(0===s.length&&1===n.length)f=n[0];else{f="JOINT"===r?new e.Bone:new e.Group;for(let e=0;e<n.length;e++)f.add(n[e])}return f.name="JOINT"===r?t.sid:t.name,f.matrix.copy(o),f.matrix.decompose(f.position,f.quaternion,f.scale),f}const je=new e.MeshBasicMaterial({color:16711935});function qe(e,t){const n=[];for(let o=0,s=e.length;o<s;o++){const s=t[e[o]];void 0===s?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",e[o]),n.push(je)):n.push(Z(s))}return n}function Se(t,n){const o=[];for(const s in t){const r=t[s],i=qe(r.materialKeys,n);if(0===i.length&&("lines"===s||"linestrips"===s?i.push(new e.LineBasicMaterial):i.push(new e.MeshPhongMaterial)),"lines"===s||"linestrips"===s)for(let t=0,n=i.length;t<n;t++){const n=i[t];if(!0===n.isMeshPhongMaterial||!0===n.isMeshLambertMaterial){const o=new e.LineBasicMaterial;o.color.copy(n.color),o.opacity=n.opacity,o.transparent=n.transparent,i[t]=o}}const a=void 0!==r.data.attributes.skinIndex,c=1===i.length?i[0]:i;let l;switch(s){case"lines":l=new e.LineSegments(r.data,c);break;case"linestrips":l=new e.Line(r.data,c);break;case"triangles":case"polylist":l=a?new e.SkinnedMesh(r.data,c):new e.Mesh(r.data,c)}o.push(l)}return o}function He(e){return void 0!==Qe.nodes[e]}function Ue(e){return m(Qe.nodes[e],Ie)}function Be(t){const n=new e.Group;n.name=t.name;const o=t.children;for(let e=0;e<o.length;e++){const t=o[e];n.add(Ue(t.id))}return n}function Fe(e){return m(Qe.visualScenes[e],Be)}if(0===n.length)return{scene:new e.Scene};const Ge=(new DOMParser).parseFromString(n,"application/xml"),ze=s(Ge,"COLLADA")[0],Pe=Ge.getElementsByTagName("parsererror")[0];if(void 0!==Pe){const e=s(Pe,"div")[0];let t;return t=e?e.textContent:function(e){let t="";const n=[e];for(;n.length;){const e=n.shift();e.nodeType===Node.TEXT_NODE?t+=e.textContent:(t+="\n",n.push.apply(n,e.childNodes))}return t.trim()}(Pe),console.error("THREE.ColladaLoader: Failed to parse collada file.\n",t),null}const Ve=ze.getAttribute("version");console.debug("THREE.ColladaLoader: File version",Ve);const De=function(e){return{unit:d(s(e,"unit")[0]),upAxis:u(s(e,"up_axis")[0])}}(s(ze,"asset")[0]),We=new e.TextureLoader(this.manager);let Je;We.setPath(this.resourcePath||o).setCrossOrigin(this.crossOrigin),t&&(Je=new t(this.manager),Je.setPath(this.resourcePath||o));const Xe=new e.Color,Ke=[];let Ye={},Ze=0;const Qe={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};f(ze,"library_animations","animation",(function t(n){const o={sources:{},samplers:{},channels:{}};let s=!1;for(let e=0,r=n.childNodes.length;e<r;e++){const r=n.childNodes[e];if(1!==r.nodeType)continue;let i;switch(r.nodeName){case"source":i=r.getAttribute("id"),o.sources[i]=ae(r);break;case"sampler":i=r.getAttribute("id"),o.samplers[i]=p(r);break;case"channel":i=r.getAttribute("target"),o.channels[i]=g(r);break;case"animation":t(r),s=!0;break;default:console.log(r)}}!1===s&&(Qe.animations[n.getAttribute("id")||e.MathUtils.generateUUID()]=o)})),f(ze,"library_animation_clips","animation_clip",(function(e){const t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];1===o.nodeType&&"instance_animation"===o.nodeName&&t.animations.push(c(o.getAttribute("url")))}Qe.clips[e.getAttribute("id")]=t})),f(ze,"library_controllers","controller",(function(e){const t={};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];if(1===o.nodeType)switch(o.nodeName){case"skin":t.id=c(o.getAttribute("source")),t.skin=L(o);break;case"morph":t.id=c(o.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}Qe.controllers[e.getAttribute("id")]=t})),f(ze,"library_images","image",(function(e){const t={init_from:s(e,"init_from")[0].textContent};Qe.images[e.getAttribute("id")]=t})),f(ze,"library_effects","effect",(function(e){const t={};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];1===o.nodeType&&"profile_COMMON"===o.nodeName&&(t.profile=S(o))}Qe.effects[e.getAttribute("id")]=t})),f(ze,"library_materials","material",(function(e){const t={name:e.getAttribute("name")};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];1===o.nodeType&&"instance_effect"===o.nodeName&&(t.url=c(o.getAttribute("url")))}Qe.materials[e.getAttribute("id")]=t})),f(ze,"library_cameras","camera",(function(e){const t={name:e.getAttribute("name")};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];1===o.nodeType&&"optics"===o.nodeName&&(t.optics=Q(o))}Qe.cameras[e.getAttribute("id")]=t})),f(ze,"library_lights","light",(function(e){let t={};for(let n=0,o=e.childNodes.length;n<o;n++){const o=e.childNodes[n];1===o.nodeType&&"technique_common"===o.nodeName&&(t=oe(o))}Qe.lights[e.getAttribute("id")]=t})),f(ze,"library_geometries","geometry",(function(e){const t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},n=s(e,"mesh")[0];if(void 0!==n){for(let e=0;e<n.childNodes.length;e++){const o=n.childNodes[e];if(1!==o.nodeType)continue;const s=o.getAttribute("id");switch(o.nodeName){case"source":t.sources[s]=ae(o);break;case"vertices":t.vertices=ce(o);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",o.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(le(o));break;default:console.log(o)}}Qe.geometries[e.getAttribute("id")]=t}})),f(ze,"library_nodes","node",Re),f(ze,"library_visual_scenes","visual_scene",(function(e){const t={name:e.getAttribute("name"),children:[]};!function(e){const t=e.getElementsByTagName("node");for(let e=0;e<t.length;e++){const n=t[e];!1===n.hasAttribute("id")&&n.setAttribute("id","three_default_"+Ze++)}}(e);const n=s(e,"node");for(let e=0;e<n.length;e++)t.children.push(Re(n[e]));Qe.visualScenes[e.getAttribute("id")]=t})),f(ze,"library_kinematics_models","kinematics_model",(function(e){const t={name:e.getAttribute("name")||"",joints:{},links:[]};for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];1===o.nodeType&&"technique_common"===o.nodeName&&ge(o,t)}Qe.kinematicsModels[e.getAttribute("id")]=t})),f(ze,"library_physics_models","physics_model",(function(e){const t={name:e.getAttribute("name")||"",rigidBodies:{}};for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];1===o.nodeType&&"rigid_body"===o.nodeName&&(t.rigidBodies[o.getAttribute("name")]={},ke(o,t.rigidBodies[o.getAttribute("name")]))}Qe.physicsModels[e.getAttribute("id")]=t})),f(ze,"scene","instance_kinematics_scene",(function(e){const t={bindJointAxis:[]};for(let n=0;n<e.childNodes.length;n++){const o=e.childNodes[n];1===o.nodeType&&"bind_joint_axis"===o.nodeName&&t.bindJointAxis.push(ve(o))}Qe.kinematicsScenes[c(e.getAttribute("url"))]=t})),h(Qe.animations,b),h(Qe.clips,_),h(Qe.controllers,I),h(Qe.images,j),h(Qe.effects,K),h(Qe.materials,Y),h(Qe.cameras,te),h(Qe.lights,re),h(Qe.geometries,ue),h(Qe.visualScenes,Be),function(){const t=Qe.clips;if(!0===l(t)){if(!1===l(Qe.animations)){const t=[];for(const e in Qe.animations){const n=y(e);for(let e=0,o=n.length;e<o;e++)t.push(n[e])}Ke.push(new e.AnimationClip("default",-1,t))}}else for(const e in t)Ke.push(R(e))}(),function(){const t=Object.keys(Qe.kinematicsModels)[0],n=Object.keys(Qe.kinematicsScenes)[0],o=Object.keys(Qe.visualScenes)[0];if(void 0===t||void 0===n)return;const s=(r=t,m(Qe.kinematicsModels[r],pe));var r;const i=function(e){return m(Qe.kinematicsScenes[e],Te)}(n),a=Fe(o),c=i.bindJointAxis,l={};for(let e=0,t=c.length;e<t;e++){const t=c[e],n=ze.querySelector('[sid="'+t.target+'"]');if(n){const e=n.parentElement;d(t.jointIndex,e)}}function d(e,t){const n=t.getAttribute("name"),o=s.joints[e];a.traverse((function(s){s.name===n&&(l[e]={object:s,transforms:Ce(t),joint:o,position:o.zeroPosition})}))}const u=new e.Matrix4;Ye={joints:s&&s.joints,getJointValue:function(e){const t=l[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(t,n){const o=l[t];if(o){const s=o.joint;if(n>s.limits.max||n<s.limits.min)console.warn("THREE.ColladaLoader: Joint "+t+" value "+n+" outside of limits (min: "+s.limits.min+", max: "+s.limits.max+").");else if(s.static)console.warn("THREE.ColladaLoader: Joint "+t+" is static.");else{const r=o.object,i=s.axis,a=o.transforms;Ee.identity();for(let o=0;o<a.length;o++){const r=a[o];if(r.sid&&-1!==r.sid.indexOf(t))switch(s.type){case"revolute":Ee.multiply(u.makeRotationAxis(i,e.MathUtils.degToRad(n)));break;case"prismatic":Ee.multiply(u.makeTranslation(i.x*n,i.y*n,i.z*n));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+s.type)}else switch(r.type){case"matrix":Ee.multiply(r.obj);break;case"translate":Ee.multiply(u.makeTranslation(r.obj.x,r.obj.y,r.obj.z));break;case"scale":Ee.scale(r.obj);break;case"rotate":Ee.multiply(u.makeRotationAxis(r.obj,r.angle))}}r.matrix.copy(Ee),r.matrix.decompose(r.position,r.quaternion,r.scale),l[t].position=n}}else console.log("THREE.ColladaLoader: "+t+" does not exist.")}}}();const $e=function(e){return Fe(c(s(e,"instance_visual_scene")[0].getAttribute("url")))}(s(ze,"scene")[0]);return $e.animations=Ke,"Z_UP"===De.upAxis&&(console.warn("THREE.ColladaLoader: You are loading an asset with a Z-UP coordinate system. The loader just rotates the asset to transform it into Y-UP. The vertex data are not converted, see #24289."),$e.rotation.set(-Math.PI/2,0,0)),$e.scale.multiplyScalar(De.unit),{get animations(){return console.warn("THREE.ColladaLoader: Please access animations over scene.animations now."),Ke},kinematics:Ye,library:Qe,scene:$e}}}AFRAME.registerComponent("collada-model",{schema:{src:{type:"asset"},colorCorrection:{default:!1}},init:function(){this.model=null,this.loader=new n},update:function(){const e=this,t=this.el,n=this.data.src,o=this.data.colorCorrection;n&&(this.remove(),this.loader.load(n,(function(n){if(e.model=n.scene,e.model.animatinos=e.model.animations,o){const n=t.sceneEl.systems.renderer;e.model.traverse((function(e){if(e.isMesh){const t=e.material;t.color&&n.applyColorCorrection(t.color),t.map&&n.applyColorCorrection(t.map),t.emissive&&n.applyColorCorrection(t.emissive),t.emissiveMap&&n.applyColorCorrection(t.emissiveMap)}}))}t.setObject3D("mesh",e.model),t.emit("model-loaded",{format:"collada",model:e.model})})))},remove:function(){this.model&&this.el.removeObject3D("mesh")}})})();